# Configuration for Cell-Type Conditioned SEDD Perturbation Prediction - Small Model
# This config contains all parameters for training cell-type conditioned perturbation prediction
# Task: perturbation label + cell-type label -> perturbed cell expression

# Model architecture
model:
  name: SEDDCellTypePerturbationTransformerSmall
  size: small  # small, medium, large
  hidden_dim: 128
  num_layers: 4
  num_heads: 4
  dropout: 0.1

# Data parameters
data:
  # Path to h5ad training data - MUST contain cell_type column
  train_data_path: null  # Set via CLI or environment variable

  # Column names in adata.obs
  gene: gene  # Perturbation labels column
  cell_type_col: cell_type  # Cell-type labels column

  control_name: non-targeting  # Name of control perturbation
  val_fraction: 0.1

  # Optional: cell_load config
  loader_path: null  # Path to cell_load TOML config

  # Optional: pre-computed embeddings
  cond_labels_pt_path: null  # Perturbation embeddings (e.g., ESM2 protein embeddings)
  celltype_labels_pt_path: null  # Cell-type embeddings (if using pre-computed)

# Training hyperparameters
training:
  batch_size: 64
  num_epochs: 50
  learning_rate: 1.0e-4
  weight_decay: 0.01
  mask_ratio: 0.15
  gradient_clip: 1.0
  optimizer:
    type: AdamW
    betas: [0.9, 0.999]

# Checkpoint and logging
checkpointing:
  checkpoint_dir: experiments/celltype_perturbseq_small
  save_interval: 5
  resume: null  # 'auto' for latest, or path to checkpoint

logging:
  log_interval: 10
  val_interval: 1

# Inference parameters
inference:
  # Cell type to generate predictions for (one at a time)
  cell_type: null  # e.g., "T cell", "B cell", null for all

  # Perturbations to generate
  perturbations: null  # List of perturbation names, or null for all
  perturbations_file: null  # File with perturbation names (one per line)

  num_samples_per_condition: 100
  num_steps: 50
  temperature: 1.0
  sampler: euler
  batch_size: 32

# Other parameters
other:
  seed: 42
  num_workers: 4

# Diffusion-specific parameters
diffusion:
  noise_schedule: LogLinearNoise
  noise_eps: 1.0e-3
  graph_type: AbsorbingGraph
